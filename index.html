<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eywallah Saat</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a1a2e">
    <link rel="icon" type="image/png" sizes="192x192" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='40' fill='%23667eea'/><text x='50' y='60' text-anchor='middle' font-size='20' fill='white'>üïê</text></svg>">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #16213e;
            --text-primary: #ffffff;
            --text-secondary: #b8b9d1;
            --accent-primary: #667eea;
            --accent-secondary: #764ba2;
            --success: #4ecdc4;
            --warning: #f38ba8;
            --error: #ff6b6b;
            --border: rgba(255, 255, 255, 0.1);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --gradient: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
        }
        
        [data-theme="light"] {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: rgba(0, 0, 0, 0.1);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            transition: all 0.3s ease;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
            position: relative;
        }
        
        /* Ana Saat Ekranƒ± */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            background: var(--bg-primary);
            position: relative;
            overflow: hidden;
        }
        
        .main-content::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .clock-container {
            text-align: center;
            z-index: 2;
            position: relative;
        }
        
        .main-clock {
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 300;
            letter-spacing: -2px;
            margin-bottom: 1rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(102, 126, 234, 0.3);
        }
        
        .date-display {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
        }
        
        .theme-toggle {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 50px;
            padding: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
            z-index: 1000;
        }
        
        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }
        
        /* Yan Panel */
        .sidebar {
            width: 350px;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
        }
        
        .sidebar-nav {
            display: flex;
            border-bottom: 1px solid var(--border);
            background: var(--bg-tertiary);
        }
        
        .nav-item {
            flex: 1;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            background: none;
            color: var(--text-secondary);
            position: relative;
            overflow: hidden;
        }
        
        .nav-item::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: var(--gradient);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateX(-50%);
        }
        
        .nav-item:hover, .nav-item.active {
            color: var(--text-primary);
            transform: translateY(-2px);
        }
        
        .nav-item.active::before {
            width: 80%;
        }
        
        .sidebar-content {
            flex: 1;
            overflow: hidden;
            position: relative;
        }
        
        .module {
            position: absolute;
            width: 100%;
            height: 100%;
            padding: 1.5rem;
            opacity: 0;
            transform: translateX(100px);
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
        }
        
        .module.active {
            opacity: 1;
            transform: translateX(0);
        }
        
        /* Auth Modal */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .auth-modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .auth-content {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transform: scale(0.9);
            transition: all 0.3s ease;
        }
        
        .auth-modal.show .auth-content {
            transform: scale(1);
        }
        
        .auth-title {
            font-size: 2rem;
            margin-bottom: 1rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .auth-input {
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .auth-input:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
        }
        
        .auth-btn {
            padding: 1rem;
            border: none;
            border-radius: 10px;
            background: var(--gradient);
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }
        
        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.4);
        }
        
        .auth-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .auth-switch {
            color: var(--accent-primary);
            cursor: pointer;
            text-decoration: underline;
            margin-top: 1rem;
        }
        
        /* Module Styles */
        .module-header {
            display: flex;
            align-items: center;
            justify-content: between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }
        
        .module-title {
            font-size: 1.5rem;
            font-weight: 600;
            flex: 1;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 10px;
            background: var(--gradient);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        
        /* Timer Display */
        .timer-display {
            text-align: center;
            margin: 2rem 0;
        }
        
        .timer-time {
            font-size: 3rem;
            font-weight: 300;
            margin-bottom: 1rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .timer-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin: 1.5rem 0;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .input-group label {
            font-weight: 600;
            color: var(--text-secondary);
        }
        
        .input-group input, .input-group select {
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-size: 1rem;
        }
        
        .alarm-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 10px;
            margin: 0.5rem 0;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }
        
        .alarm-item:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
        }
        
        .alarm-time {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .alarm-toggle {
            width: 60px;
            height: 30px;
            background: var(--border);
            border-radius: 15px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .alarm-toggle.active {
            background: var(--accent-primary);
        }
        
        .alarm-toggle::after {
            content: '';
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: all 0.3s ease;
        }
        
        .alarm-toggle.active::after {
            transform: translateX(30px);
        }
        
        .progress-ring {
            width: 200px;
            height: 200px;
            margin: 2rem auto;
        }
        
        .progress-ring__circle {
            stroke: var(--accent-primary);
            stroke-linecap: round;
            transition: stroke-dasharray 0.35s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        
        .progress-ring__background {
            stroke: var(--border);
            stroke-width: 8;
            fill: transparent;
        }
        
        .chart-container {
            margin: 2rem 0;
            height: 300px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            padding: 1rem;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 50vh;
                border-left: none;
                border-top: 1px solid var(--border);
            }
            
            .main-content {
                height: 50vh;
            }
            
            .main-clock {
                font-size: clamp(2rem, 10vw, 4rem);
            }
        }
        
        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent-primary);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Notification Styles */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 1rem 1.5rem;
            box-shadow: var(--shadow);
            z-index: 1001;
            transform: translateX(400px);
            transition: all 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-left: 4px solid var(--success);
        }
        
        .notification.error {
            border-left: 4px solid var(--error);
        }
        
        .notification.warning {
            border-left: 4px solid var(--warning);
        }
        
        /* Smooth scroll effects */
        .scroll-container {
            scroll-behavior: smooth;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .scroll-container::-webkit-scrollbar {
            display: none;
        }
        
        /* GTA 6 style parallax effect */
        .parallax-layer {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0.1;
            pointer-events: none;
            transition: transform 0.1s ease-out;
        }
        
        /* PWA Install Prompt */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 15px;
            padding: 1rem 2rem;
            box-shadow: var(--shadow);
            z-index: 1000;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .install-prompt.show {
            transform: translateX(-50%) translateY(0);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Ana Saat Ekranƒ± -->
        <div class="main-content">
            <div class="parallax-layer"></div>
            
            <button class="theme-toggle" onclick="toggleTheme()">
                <span id="theme-icon">üåô</span>
            </button>
            
            <div class="clock-container">
                <div class="main-clock" id="main-clock">00:00:00</div>
                <div class="date-display" id="date-display"></div>
            </div>
        </div>
        
        <!-- Yan Panel -->
        <div class="sidebar">
            <div class="sidebar-nav">
                <button class="nav-item active" onclick="switchModule('alarm')">‚è∞ Alarm</button>
                <button class="nav-item" onclick="switchModule('timer')">‚è≤Ô∏è Timer</button>
                <button class="nav-item" onclick="switchModule('pomodoro')">üçÖ Pomodoro</button>
                <button class="nav-item" onclick="switchModule('stopwatch')">‚è±Ô∏è Kronometre</button>
            </div>
            
            <div class="sidebar-content">
                <!-- Alarm Mod√ºl√º -->
                <div class="module active" id="alarm-module">
                    <div class="module-header">
                        <h3 class="module-title">Alarmlar</h3>
                        <button class="btn" onclick="showAddAlarm()">+ Ekle</button>
                    </div>
                    <div id="alarm-list"></div>
                    
                    <div id="add-alarm-form" style="display: none;">
                        <div class="input-group">
                            <label>Alarm Saati</label>
                            <input type="time" id="alarm-time">
                        </div>
                        <div class="input-group">
                            <label>Etiket</label>
                            <input type="text" id="alarm-label" placeholder="Alarm etiketi">
                        </div>
                        <div class="timer-controls">
                            <button class="btn" onclick="addAlarm()">Kaydet</button>
                            <button class="btn btn-secondary" onclick="hideAddAlarm()">ƒ∞ptal</button>
                        </div>
                    </div>
                </div>
                
                <!-- Timer Mod√ºl√º -->
                <div class="module" id="timer-module">
                    <div class="module-header">
                        <h3 class="module-title">Zamanlayƒ±cƒ±</h3>
                    </div>
                    
                    <div class="timer-display">
                        <div class="timer-time" id="timer-display">00:00</div>
                        <svg class="progress-ring" width="200" height="200">
                            <circle class="progress-ring__background" cx="100" cy="100" r="90"></circle>
                            <circle class="progress-ring__circle" cx="100" cy="100" r="90" 
                                    stroke-width="8" fill="transparent" 
                                    stroke-dasharray="565.48" stroke-dashoffset="565.48" id="timer-progress"></circle>
                        </svg>
                    </div>
                    
                    <div class="input-group">
                        <label>S√ºre (dakika)</label>
                        <input type="number" id="timer-minutes" min="1" max="999" value="25">
                    </div>
                    
                    <div class="timer-controls">
                        <button class="btn" id="timer-start" onclick="startTimer()">Ba≈ülat</button>
                        <button class="btn btn-secondary" onclick="pauseTimer()">Duraklat</button>
                        <button class="btn btn-secondary" onclick="resetTimer()">Sƒ±fƒ±rla</button>
                    </div>
                </div>
                
                <!-- Pomodoro Mod√ºl√º -->
                <div class="module" id="pomodoro-module">
                    <div class="module-header">
                        <h3 class="module-title">Pomodoro</h3>
                    </div>
                    
                    <div class="timer-display">
                        <div class="timer-time" id="pomodoro-display">25:00</div>
                        <div style="text-align: center; margin: 1rem 0;">
                            <span id="pomodoro-status">√áalƒ±≈üma Zamanƒ±</span> | 
                            <span id="pomodoro-count">0</span> Pomodoro
                        </div>
                        <svg class="progress-ring" width="200" height="200">
                            <circle class="progress-ring__background" cx="100" cy="100" r="90"></circle>
                            <circle class="progress-ring__circle" cx="100" cy="100" r="90" 
                                    stroke-width="8" fill="transparent" 
                                    stroke-dasharray="565.48" stroke-dashoffset="565.48" id="pomodoro-progress"></circle>
                        </svg>
                    </div>
                    
                    <div class="input-group">
                        <label>√áalƒ±≈üma S√ºresi (dk)</label>
                        <input type="number" id="work-time" min="1" max="60" value="25">
                    </div>
                    
                    <div class="input-group">
                        <label>Mola S√ºresi (dk)</label>
                        <input type="number" id="break-time" min="1" max="30" value="5">
                    </div>
                    
                    <div class="timer-controls">
                        <button class="btn" id="pomodoro-start" onclick="startPomodoro()">Ba≈ülat</button>
                        <button class="btn btn-secondary" onclick="pausePomodoro()">Duraklat</button>
                        <button class="btn btn-secondary" onclick="resetPomodoro()">Sƒ±fƒ±rla</button>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="pomodoro-chart" width="400" height="200"></canvas>
                    </div>
                </div>
                
                <!-- Kronometre Mod√ºl√º -->
                <div class="module" id="stopwatch-module">
                    <div class="module-header">
                        <h3 class="module-title">Kronometre</h3>
                    </div>
                    
                    <div class="timer-display">
                        <div class="timer-time" id="stopwatch-display">00:00:00</div>
                    </div>
                    
                    <div class="timer-controls">
                        <button class="btn" id="stopwatch-start" onclick="startStopwatch()">Ba≈ülat</button>
                        <button class="btn btn-secondary" onclick="pauseStopwatch()">Duraklat</button>
                        <button class="btn btn-secondary" onclick="resetStopwatch()">Sƒ±fƒ±rla</button>
                        <button class="btn btn-secondary" onclick="lapStopwatch()">Tur</button>
                    </div>
                    
                    <div id="laps-list" style="margin-top: 2rem;"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Auth Modal -->
    <div class="auth-modal" id="auth-modal">
        <div class="auth-content">
            <h2 class="auth-title">üïê Eywallah Saat</h2>
            <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                Verilerinizi kaydetmek i√ßin giri≈ü yapƒ±n
            </p>
            
            <div class="auth-form">
                <input type="email" class="auth-input" id="auth-email" placeholder="E-posta adresiniz">
                <input type="password" class="auth-input" id="auth-password" placeholder="≈ûifreniz">
                <button class="auth-btn" id="auth-submit" onclick="handleAuth()">
                    <span id="auth-btn-text">Giri≈ü Yap</span>
                    <div id="auth-loading" class="loading" style="display: none;"></div>
                </button>
            </div>
            
            <p class="auth-switch" id="auth-switch" onclick="toggleAuthMode()">
                Hesabƒ±nƒ±z yok mu? Kayƒ±t olun
            </p>
        </div>
    </div>
    
    <!-- PWA Install Prompt -->
    <div class="install-prompt" id="install-prompt">
        <span>üì± Uygulamayƒ± ana ekrana ekleyin</span>
        <button class="btn" onclick="installApp()">Ekle</button>
        <button class="btn btn-secondary" onclick="dismissInstall()">Daha Sonra</button>
    </div>

    <!-- Firebase SDK -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-auth-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-firestore-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-messaging-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "demo-key",
            authDomain: "demo-project.firebaseapp.com",
            projectId: "demo-project",
            storageBucket: "demo-project.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcdef"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Global Variables
        let currentUser = null;
        let isLoginMode = true;
        let currentTheme = 'dark';
        let alarms = [];
        let timers = {
            timer: null,
            pomodoro: null,
            stopwatch: null
        };
        let timerStates = {
            timer: { running: false, timeLeft: 0, totalTime: 0 },
            pomodoro: { running: false, timeLeft: 0, totalTime: 0, isBreak: false, count: 0 },
            stopwatch: { running: false, time: 0, laps: [] }
        };
        
        // PWA Variables
        let deferredPrompt;
        let notificationPermission = false;
        
        // Audio Context for alarms
        let audioContext;
        let alarmSound;
        
        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            updateClock();
            setInterval(updateClock, 1000);
            requestNotificationPermission();
            checkPWAInstall();
            initializeAudio();
            addParallaxEffect();
        });
        
        function initializeApp() {
            // Check authentication state
            auth.onAuthStateChanged(function(user) {
                if (user) {
                    currentUser = user;
                    document.getElementById('auth-modal').classList.remove('show');
                    loadUserData();
                } else {
                    currentUser = null;
                    document.getElementById('auth-modal').classList.add('show');
                }
            });
            
            // Load theme
            const savedTheme = localStorage.getItem('theme') || 'dark';
            setTheme(savedTheme);
        }
        
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('tr-TR');
            const dateString = now.toLocaleDateString('tr-TR', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            document.getElementById('main-clock').textContent = timeString;
            document.getElementById('date-display').textContent = dateString;
            
            // Check alarms
            checkAlarms(now);
        }
        
        function checkAlarms(now) {
            const currentTime = now.toTimeString().slice(0, 5);
            alarms.forEach(alarm => {
                if (alarm.enabled && alarm.time === currentTime && !alarm.triggered) {
                    triggerAlarm(alarm);
                    alarm.triggered = true;
                    setTimeout(() => { alarm.triggered = false; }, 60000); // Reset after 1 minute
                }
            });
        }
        
        function triggerAlarm(alarm) {
            playAlarmSound();
            showNotification('‚è∞ Alarm', alarm.label || 'Alarm √ßalƒ±yor!', 'warning');
            
            if ('vibrate' in navigator) {
                navigator.vibrate([500, 200, 500, 200, 500]);
            }
            
            // Send push notification if supported
            if (notificationPermission) {
                new Notification('üïê Eywallah Saat - Alarm', {
                    body: alarm.label || 'Alarm √ßalƒ±yor!',
                    icon: '/icon-192x192.png',
                    badge: '/icon-192x192.png',
                    tag: 'alarm',
                    requireInteraction: true
                });
            }
        }
        
        // Authentication Functions
        async function handleAuth() {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            const submitBtn = document.getElementById('auth-submit');
            const btnText = document.getElementById('auth-btn-text');
            const loading = document.getElementById('auth-loading');
            
            if (!email || !password) {
                showNotification('Hata', 'E-posta ve ≈üifre gereklidir', 'error');
                return;
            }
            
            // Show loading
            btnText.style.display = 'none';
            loading.style.display = 'inline-block';
            submitBtn.disabled = true;
            
            try {
                if (isLoginMode) {
                    await auth.signInWithEmailAndPassword(email, password);
                    showNotification('Ba≈üarƒ±lƒ±', 'Giri≈ü yapƒ±ldƒ±', 'success');
                } else {
                    await auth.createUserWithEmailAndPassword(email, password);
                    showNotification('Ba≈üarƒ±lƒ±', 'Hesap olu≈üturuldu', 'success');
                }
            } catch (error) {
                showNotification('Hata', getErrorMessage(error.code), 'error');
            } finally {
                btnText.style.display = 'inline';
                loading.style.display = 'none';
                submitBtn.disabled = false;
            }
        }
        
        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            const title = document.querySelector('.auth-title');
            const btnText = document.getElementById('auth-btn-text');
            const switchText = document.getElementById('auth-switch');
            
            if (isLoginMode) {
                title.textContent = 'üïê Eywallah Saat';
                btnText.textContent = 'Giri≈ü Yap';
                switchText.textContent = 'Hesabƒ±nƒ±z yok mu? Kayƒ±t olun';
            } else {
                title.textContent = 'üïê Hesap Olu≈ütur';
                btnText.textContent = 'Kayƒ±t Ol';
                switchText.textContent = 'Zaten hesabƒ±nƒ±z var mƒ±? Giri≈ü yapƒ±n';
            }
        }
        
        function getErrorMessage(errorCode) {
            const messages = {
                'auth/user-not-found': 'Kullanƒ±cƒ± bulunamadƒ±',
                'auth/wrong-password': 'Yanlƒ±≈ü ≈üifre',
                'auth/email-already-in-use': 'Bu e-posta zaten kullanƒ±mda',
                'auth/weak-password': '≈ûifre √ßok zayƒ±f',
                'auth/invalid-email': 'Ge√ßersiz e-posta adresi'
            };
            return messages[errorCode] || 'Bir hata olu≈ütu';
        }
        
        // Theme Functions
        function toggleTheme() {
            currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
            setTheme(currentTheme);
        }
        
        function setTheme(theme) {
            currentTheme = theme;
            document.documentElement.setAttribute('data-theme', theme);
            document.getElementById('theme-icon').textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            localStorage.setItem('theme', theme);
            
            // Save to Firestore if user is logged in
            if (currentUser) {
                saveUserPreferences();
            }
        }
        
        // Module Navigation
        function switchModule(moduleId) {
            // Remove active class from all nav items and modules
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.module').forEach(module => module.classList.remove('active'));
            
            // Add active class to clicked nav item and corresponding module
            event.target.classList.add('active');
            document.getElementById(moduleId + '-module').classList.add('active');
            
            // Load module data
            if (moduleId === 'pomodoro') {
                loadPomodoroChart();
            }
        }
        
        // Data Management
        async function loadUserData() {
            if (!currentUser) return;
            
            try {
                // Load user preferences
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                if (userDoc.exists) {
                    const data = userDoc.data();
                    if (data.theme) {
                        setTheme(data.theme);
                    }
                }
                
                // Load alarms
                const alarmsSnapshot = await db.collection('users').doc(currentUser.uid)
                    .collection('alarms').orderBy('time').get();
                alarms = alarmsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderAlarms();
                
                // Load pomodoro stats
                loadPomodoroStats();
                
            } catch (error) {
                console.error('Error loading user data:', error);
                showNotification('Hata', 'Veriler y√ºklenemedi', 'error');
            }
        }
        
        async function saveUserPreferences() {
            if (!currentUser) return;
            
            try {
                await db.collection('users').doc(currentUser.uid).set({
                    theme: currentTheme,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
            } catch (error) {
                console.error('Error saving preferences:', error);
            }
        }
        
        // Alarm Functions
        function showAddAlarm() {
            document.getElementById('add-alarm-form').style.display = 'block';
            document.getElementById('alarm-time').value = '';
            document.getElementById('alarm-label').value = '';
        }
        
        function hideAddAlarm() {
            document.getElementById('add-alarm-form').style.display = 'none';
        }
        
        async function addAlarm() {
            const time = document.getElementById('alarm-time').value;
            const label = document.getElementById('alarm-label').value || 'Alarm';
            
            if (!time) {
                showNotification('Hata', 'Alarm saati gereklidir', 'error');
                return;
            }
            
            const alarm = {
                time: time,
                label: label,
                enabled: true,
                created: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            try {
                if (currentUser) {
                    const docRef = await db.collection('users').doc(currentUser.uid)
                        .collection('alarms').add(alarm);
                    alarm.id = docRef.id;
                }
                
                alarms.push(alarm);
                renderAlarms();
                hideAddAlarm();
                showNotification('Ba≈üarƒ±lƒ±', 'Alarm eklendi', 'success');
            } catch (error) {
                console.error('Error adding alarm:', error);
                showNotification('Hata', 'Alarm eklenemedi', 'error');
            }
        }
        
        async function toggleAlarm(alarmId) {
            const alarm = alarms.find(a => a.id === alarmId);
            if (!alarm) return;
            
            alarm.enabled = !alarm.enabled;
            
            try {
                if (currentUser) {
                    await db.collection('users').doc(currentUser.uid)
                        .collection('alarms').doc(alarmId).update({
                            enabled: alarm.enabled
                        });
                }
                renderAlarms();
            } catch (error) {
                console.error('Error updating alarm:', error);
            }
        }
        
        async function deleteAlarm(alarmId) {
            try {
                if (currentUser) {
                    await db.collection('users').doc(currentUser.uid)
                        .collection('alarms').doc(alarmId).delete();
                }
                
                alarms = alarms.filter(a => a.id !== alarmId);
                renderAlarms();
                showNotification('Ba≈üarƒ±lƒ±', 'Alarm silindi', 'success');
            } catch (error) {
                console.error('Error deleting alarm:', error);
                showNotification('Hata', 'Alarm silinemedi', 'error');
            }
        }
        
        function renderAlarms() {
            const alarmList = document.getElementById('alarm-list');
            alarmList.innerHTML = '';
            
            if (alarms.length === 0) {
                alarmList.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 2rem;">Hen√ºz alarm eklenmemi≈ü</p>';
                return;
            }
            
            alarms.forEach(alarm => {
                const alarmElement = document.createElement('div');
                alarmElement.className = 'alarm-item';
                alarmElement.innerHTML = `
                    <div>
                        <div class="alarm-time">${alarm.time}</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary);">${alarm.label}</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div class="alarm-toggle ${alarm.enabled ? 'active' : ''}" 
                             onclick="toggleAlarm('${alarm.id}')"></div>
                        <button onclick="deleteAlarm('${alarm.id}')" 
                                style="background: none; border: none; color: var(--error); cursor: pointer; font-size: 1.2rem;">üóëÔ∏è</button>
                    </div>
                `;
                alarmList.appendChild(alarmElement);
            });
        }
        
        // Timer Functions
        function startTimer() {
            const minutes = parseInt(document.getElementById('timer-minutes').value) || 25;
            const totalTime = minutes * 60;
            
            if (timerStates.timer.running) {
                pauseTimer();
                return;
            }
            
            if (timerStates.timer.timeLeft === 0) {
                timerStates.timer.timeLeft = totalTime;
                timerStates.timer.totalTime = totalTime;
            }
            
            timerStates.timer.running = true;
            document.getElementById('timer-start').textContent = 'Duraklat';
            
            timers.timer = setInterval(() => {
                timerStates.timer.timeLeft--;
                updateTimerDisplay();
                updateTimerProgress();
                
                if (timerStates.timer.timeLeft <= 0) {
                    timerComplete();
                }
            }, 1000);
        }
        
        function pauseTimer() {
            timerStates.timer.running = false;
            clearInterval(timers.timer);
            document.getElementById('timer-start').textContent = 'Ba≈ülat';
        }
        
        function resetTimer() {
            pauseTimer();
            timerStates.timer.timeLeft = 0;
            timerStates.timer.totalTime = 0;
            updateTimerDisplay();
            updateTimerProgress();
        }
        
        function timerComplete() {
            pauseTimer();
            playAlarmSound();
            showNotification('‚è≤Ô∏è Timer', 'S√ºre doldu!', 'success');
            
            if (notificationPermission) {
                new Notification('üïê Eywallah Saat - Timer', {
                    body: 'Zamanlayƒ±cƒ± s√ºresi doldu!',
                    icon: '/icon-192x192.png'
                });
            }
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(timerStates.timer.timeLeft / 60);
            const seconds = timerStates.timer.timeLeft % 60;
            document.getElementById('timer-display').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function updateTimerProgress() {
            const circle = document.getElementById('timer-progress');
            const circumference = 2 * Math.PI * 90;
            const progress = timerStates.timer.totalTime > 0 ? 
                (timerStates.timer.totalTime - timerStates.timer.timeLeft) / timerStates.timer.totalTime : 0;
            const offset = circumference - (progress * circumference);
            circle.style.strokeDashoffset = offset;
        }
        
        // Pomodoro Functions
        function startPomodoro() {
            if (timerStates.pomodoro.running) {
                pausePomodoro();
                return;
            }
            
            if (timerStates.pomodoro.timeLeft === 0) {
                const workTime = parseInt(document.getElementById('work-time').value) || 25;
                const breakTime = parseInt(document.getElementById('break-time').value) || 5;
                
                const time = timerStates.pomodoro.isBreak ? breakTime : workTime;
                timerStates.pomodoro.timeLeft = time * 60;
                timerStates.pomodoro.totalTime = time * 60;
            }
            
            timerStates.pomodoro.running = true;
            document.getElementById('pomodoro-start').textContent = 'Duraklat';
            
            timers.pomodoro = setInterval(() => {
                timerStates.pomodoro.timeLeft--;
                updatePomodoroDisplay();
                updatePomodoroProgress();
                
                if (timerStates.pomodoro.timeLeft <= 0) {
                    pomodoroComplete();
                }
            }, 1000);
        }
        
        function pausePomodoro() {
            timerStates.pomodoro.running = false;
            clearInterval(timers.pomodoro);
            document.getElementById('pomodoro-start').textContent = 'Ba≈ülat';
        }
        
        function resetPomodoro() {
            pausePomodoro();
            timerStates.pomodoro.timeLeft = 0;
            timerStates.pomodoro.totalTime = 0;
            timerStates.pomodoro.isBreak = false;
            updatePomodoroDisplay();
            updatePomodoroProgress();
            updatePomodoroStatus();
        }
        
        async function pomodoroComplete() {
            pausePomodoro();
            playAlarmSound();
            
            if (!timerStates.pomodoro.isBreak) {
                timerStates.pomodoro.count++;
                await savePomodoroSession();
                showNotification('üçÖ Pomodoro', '√áalƒ±≈üma tamamlandƒ±! Mola zamanƒ±.', 'success');
            } else {
                showNotification('üçÖ Pomodoro', 'Mola bitti! √áalƒ±≈ümaya d√∂n√ºn.', 'warning');
            }
            
            timerStates.pomodoro.isBreak = !timerStates.pomodoro.isBreak;
            timerStates.pomodoro.timeLeft = 0;
            updatePomodoroStatus();
            
            if (notificationPermission) {
                const message = timerStates.pomodoro.isBreak ? 'Mola zamanƒ±!' : '√áalƒ±≈üma zamanƒ±!';
                new Notification('üçÖ Eywallah Saat - Pomodoro', {
                    body: message,
                    icon: '/icon-192x192.png'
                });
            }
        }
        
        function updatePomodoroDisplay() {
            const minutes = Math.floor(timerStates.pomodoro.timeLeft / 60);
            const seconds = timerStates.pomodoro.timeLeft % 60;
            document.getElementById('pomodoro-display').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function updatePomodoroProgress() {
            const circle = document.getElementById('pomodoro-progress');
            const circumference = 2 * Math.PI * 90;
            const progress = timerStates.pomodoro.totalTime > 0 ? 
                (timerStates.pomodoro.totalTime - timerStates.pomodoro.timeLeft) / timerStates.pomodoro.totalTime : 0;
            const offset = circumference - (progress * circumference);
            circle.style.strokeDashoffset = offset;
        }
        
        function updatePomodoroStatus() {
            const status = timerStates.pomodoro.isBreak ? 'Mola Zamanƒ±' : '√áalƒ±≈üma Zamanƒ±';
            document.getElementById('pomodoro-status').textContent = status;
            document.getElementById('pomodoro-count').textContent = timerStates.pomodoro.count;
        }
        
        async function savePomodoroSession() {
            if (!currentUser) return;
            
            try {
                const today = new Date().toISOString().split('T')[0];
                await db.collection('users').doc(currentUser.uid)
                    .collection('pomodoros').add({
                        date: today,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        workTime: parseInt(document.getElementById('work-time').value) || 25,
                        breakTime: parseInt(document.getElementById('break-time').value) || 5
                    });
            } catch (error) {
                console.error('Error saving pomodoro session:', error);
            }
        }
        
        async function loadPomodoroStats() {
            if (!currentUser) return;
            
            try {
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                
                const pomodorosSnapshot = await db.collection('users').doc(currentUser.uid)
                    .collection('pomodoros')
                    .where('timestamp', '>=', thirtyDaysAgo)
                    .orderBy('timestamp')
                    .get();
                
                const stats = {};
                pomodorosSnapshot.docs.forEach(doc => {
                    const data = doc.data();
                    if (data.date) {
                        stats[data.date] = (stats[data.date] || 0) + 1;
                    }
                });
                
                updatePomodoroChart(stats);
            } catch (error) {
                console.error('Error loading pomodoro stats:', error);
            }
        }
        
        function loadPomodoroChart() {
            // This will be called when switching to pomodoro module
            if (currentUser) {
                loadPomodoroStats();
            }
        }
        
        function updatePomodoroChart(stats) {
            const ctx = document.getElementById('pomodoro-chart').getContext('2d');
            
            // Prepare data for last 7 days
            const labels = [];
            const data = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                labels.push(date.toLocaleDateString('tr-TR', { weekday: 'short' }));
                data.push(stats[dateStr] || 0);
            }
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Pomodoro Sayƒ±sƒ±',
                        data: data,
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 1,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }
        
        // Stopwatch Functions
        function startStopwatch() {
            if (timerStates.stopwatch.running) {
                pauseStopwatch();
                return;
            }
            
            timerStates.stopwatch.running = true;
            document.getElementById('stopwatch-start').textContent = 'Duraklat';
            
            const startTime = Date.now() - timerStates.stopwatch.time;
            
            timers.stopwatch = setInterval(() => {
                timerStates.stopwatch.time = Date.now() - startTime;
                updateStopwatchDisplay();
            }, 10); // Update every 10ms for precision
        }
        
        function pauseStopwatch() {
            timerStates.stopwatch.running = false;
            clearInterval(timers.stopwatch);
            document.getElementById('stopwatch-start').textContent = 'Ba≈ülat';
        }
        
        function resetStopwatch() {
            pauseStopwatch();
            timerStates.stopwatch.time = 0;
            timerStates.stopwatch.laps = [];
            updateStopwatchDisplay();
            renderLaps();
        }
        
        function lapStopwatch() {
            if (timerStates.stopwatch.running) {
                const lapTime = timerStates.stopwatch.time;
                timerStates.stopwatch.laps.unshift(lapTime);
                renderLaps();
            }
        }
        
        function updateStopwatchDisplay() {
            const time = timerStates.stopwatch.time;
            const hours = Math.floor(time / 3600000);
            const minutes = Math.floor((time % 3600000) / 60000);
            const seconds = Math.floor((time % 60000) / 1000);
            const milliseconds = Math.floor((time % 1000) / 10);
            
            document.getElementById('stopwatch-display').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${milliseconds.toString().padStart(2, '0')}`;
        }
        
        function renderLaps() {
            const lapsList = document.getElementById('laps-list');
            lapsList.innerHTML = '';
            
            if (timerStates.stopwatch.laps.length === 0) return;
            
            const title = document.createElement('h4');
            title.textContent = 'Turlar';
            title.style.marginBottom = '1rem';
            lapsList.appendChild(title);
            
            timerStates.stopwatch.laps.forEach((lapTime, index) => {
                const lapElement = document.createElement('div');
                lapElement.style.cssText = `
                    display: flex;
                    justify-content: space-between;
                    padding: 0.5rem 1rem;
                    background: var(--bg-tertiary);
                    border-radius: 8px;
                    margin-bottom: 0.5rem;
                `;
                
                const hours = Math.floor(lapTime / 3600000);
                const minutes = Math.floor((lapTime % 3600000) / 60000);
                const seconds = Math.floor((lapTime % 60000) / 1000);
                const milliseconds = Math.floor((lapTime % 1000) / 10);
                
                const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${milliseconds.toString().padStart(2, '0')}`;
                
                lapElement.innerHTML = `
                    <span>Tur ${timerStates.stopwatch.laps.length - index}</span>
                    <span>${timeString}</span>
                `;
                lapsList.appendChild(lapElement);
            });
        }
        
        // Audio Functions
        function initializeAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (error) {
                console.warn('Web Audio API not supported');
            }
        }
        
        function playAlarmSound() {
            if (!audioContext) {
                // Fallback to HTML5 audio
                const audio = new Audio();
                audio.src = 'data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhPWKwrQmzfxo...';
                audio.play().catch(() => {});
                return;
            }
            
            // Generate beep sound
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'square';
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.1);
            gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }
        
        // Notification Functions
        async function requestNotificationPermission() {
            if ('Notification' in window) {
                const permission = await Notification.requestPermission();
                notificationPermission = permission === 'granted';
            }
        }
        
        function showNotification(title, message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div>
                    <strong>${title}</strong>
                    <div>${message}</div>
                </div>
            `;
            
            document.body.appendChild(notification);
            setTimeout(() => notification.classList.add('show'), 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 4000);
        }
        
        // PWA Functions
        function checkPWAInstall() {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                showInstallPrompt();
            });
            
            window.addEventListener('appinstalled', () => {
                hideInstallPrompt();
                showNotification('Ba≈üarƒ±lƒ±', 'Uygulama ana ekrana eklendi', 'success');
            });
        }
        
        function showInstallPrompt() {
            const prompt = document.getElementById('install-prompt');
            setTimeout(() => prompt.classList.add('show'), 3000);
        }
        
        function hideInstallPrompt() {
            document.getElementById('install-prompt').classList.remove('show');
        }
        
        async function installApp() {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                hideInstallPrompt();
            }
            
            deferredPrompt = null;
        }
        
        function dismissInstall() {
            hideInstallPrompt();
            localStorage.setItem('installDismissed', 'true');
        }
        
        // Parallax Effect (GTA 6 style)
        function addParallaxEffect() {
            const parallaxLayer = document.querySelector('.parallax-layer');
            let mouseX = 0;
            let mouseY = 0;
            let currentX = 0;
            let currentY = 0;
            
            document.addEventListener('mousemove', (e) => {
                mouseX = (e.clientX - window.innerWidth / 2) * 0.01;
                mouseY = (e.clientY - window.innerHeight / 2) * 0.01;
            });
            
            function animate() {
                currentX += (mouseX - currentX) * 0.1;
                currentY += (mouseY - currentY) * 0.1;
                
                parallaxLayer.style.transform = `translate(${currentX}px, ${currentY}px) rotate(${currentX * 0.5}deg)`;
                
                requestAnimationFrame(animate);
            }
            
            animate();
        }
        
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('SW registered: ', registration);
                } catch (registrationError) {
                    console.log('SW registration failed: ', registrationError);
                }
            });
        }
        
        // Keyboard Shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.altKey) {
                switch
